@model QueryIndexViewModel
@using Orchard.ContentManagement;
@inject IContentManager ContentManager

<script asp-src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/codemirror.js" depends-on="admin" at="Foot"></script>
<script asp-src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/mode/javascript/javascript.js" at="Foot"></script>
<style asp-src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/codemirror.css"></style>

<h1>@RenderTitleSegments(T["Lucene Query"])</h1>

<form asp-action="Index" method="post" class="for">
    <input asp-for="IndexName" type="hidden" />
    
    <div class="form-group">
        <label asp-for="Query">@T["Query"]</label>
        <textarea asp-for="Query" rows="12" class="form-control" id="query"></textarea>
    </div>
    <div class="form-group">
        <button type="submit" class="btn btn-primary">@T["Query"]</button>
    </div>

    @if (Model.Documents.Any())
    {
        <span class="text-muted">@T["Query executed in {0} ms", Model.Duration.TotalMilliseconds]</span>
        <ul class="list-group">
            @foreach (var document in Model.Documents)
            {
                var contentItemId = document.GetField("ContentItemId").StringValue;
                var contentItem = await ContentManager.GetAsync(contentItemId, VersionOptions.Latest);

                <li class="list-group-item">
                    <a admin-for="@contentItem" />
                </li>
            }
        </ul>
    }
</form>

<script at="Foot">
    $(function() {
        var myCodeMirror = CodeMirror.fromTextArea(document.getElementById('query'));
    });
</script>
